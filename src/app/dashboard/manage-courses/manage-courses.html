<!-- üåê Navbar -->
<app-navbar></app-navbar>

<!-- üìö Contenu principal -->
<div class="manage-courses-page">
  <!-- Snackbar Notification -->
  @if (showSnackbar) {
    <div class="snackbar" [class.snackbar-success]="snackbarType === 'success'" [class.snackbar-error]="snackbarType === 'error'">
      <div class="snackbar-content">
        <span class="snackbar-icon" [class.icon-check]="snackbarType === 'success'" [class.icon-error]="snackbarType === 'error'"></span>
        {{ snackbarMessage }}
      </div>
    </div>
  }

  <!-- Page Header -->
  <header class="page-header">
    <div class="header-content">
      <h1>üìö G√©rer mes cours</h1>
      <p>Cr√©ez, modifiez et organisez votre contenu √©ducatif</p>
    </div>
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-number">{{ courses.length }}</span>
        <span class="stat-label">Cours</span>
      </div>
    </div>
  </header>

  <!-- Messages -->
  @if (successMessage) {
    <div class="alert alert-success">
      <div class="alert-icon">‚úÖ</div>
      <div class="alert-content">
        <strong>Succ√®s !</strong> {{ successMessage }}
      </div>
      <button class="alert-close" (click)="successMessage = ''">&times;</button>
    </div>
  }

  @if (errorMessage) {
    <div class="alert alert-error">
      <div class="alert-icon">‚ùå</div>
      <div class="alert-content">
        <strong>Erreur :</strong> {{ errorMessage }}
      </div>
      <button class="alert-close" (click)="errorMessage = ''">&times;</button>
    </div>
  }

  <!-- Formulaire -->
  <section class="create-course-form">
    <div class="form-card">
      <div class="form-header">
        <h2>
          @if (mode === 'create') {
            <i class="icon-add"></i> Cr√©er un nouveau cours
          } @else {
            <i class="icon-edit"></i> Modifier le cours : {{ oldCourse.title }}
          }
        </h2>
        <div class="form-mode-indicator" [class.mode-create]="mode === 'create'" [class.mode-edit]="mode === 'edit'">
          {{ mode === 'create' ? 'Cr√©ation' : 'Modification' }}
        </div>
      </div>

      <form (ngSubmit)="onCreateCourse()" novalidate>
        <div class="two-column-layout">
          <!-- Left Column: Course Details -->
          <div class="left-column">
            <!-- Titre -->
            <div class="form-group" [class.error]="formErrors['title']">
              <label for="courseTitle">Titre du cours *</label>
              <input type="text" id="courseTitle" [(ngModel)]="oldCourse.title" name="title"
                     placeholder="Entrez le titre du cours" [class.error]="formErrors['title']" required>
              @if (formErrors['title']) {
                <div class="error-message">{{ formErrors['title'] }}</div>
              }
            </div>

            <div class="form-group" [class.error]="formErrors['description']">
              <label for="courseDescription">Description *</label>
              <textarea id="courseDescription" [(ngModel)]="newCourse.description" name="description"
                        rows="4" placeholder="D√©crivez ce que les √©tudiants apprendront dans ce cours"
                        [class.error]="formErrors['description']" required></textarea>
              @if (formErrors['description']) {
                <div class="error-message">{{ formErrors['description'] }}</div>
              }
            </div>

            <!-- Category field only shown when creating a course -->
            @if (mode === 'create') {
              <div class="form-row">
                <div class="form-group">
                  <label for="courseCategory">Cat√©gorie</label>
                  <select id="courseCategory" [(ngModel)]="oldCourse.category" name="category">
                    <option value="">S√©lectionner une cat√©gorie...</option>
                    <option value="devops">üîß DevOps</option>
                    <option value="cloud_computing">‚òÅÔ∏è Cloud Computing</option>
                    <option value="web_development">üåê D√©veloppement Web</option>
                    <option value="backend_development">‚öôÔ∏è Backend Development</option>
                    <option value="cyber_security">üõ°Ô∏è Cybers√©curit√©</option>
                    <option value="solution_architect">üèóÔ∏è Architecture de Solutions</option>
                    <option value="software_engineering">üíª Ing√©nierie Logicielle</option>
                    <option value="ai_engineering">ü§ñ Ing√©nierie IA</option>
                    <option value="database">üóÑÔ∏è Base de Donn√©es</option>
                    <option value="other">üìÅ Autre</option>
                  </select>
                </div>
              </div>
            }

            <div class="form-group">
              <label for="courseImage">URL de l'image de couverture</label>
              <input type="url" id="courseImage" [(ngModel)]="oldCourse.image_url" name="image_url"
                     placeholder="https://exemple.com/image.jpg">
              <small>Optionnel : URL de la vignette du cours</small>
            </div>

            <div class="form-group">
              <label for="youtubeVideoUrl">URL de la vid√©o YouTube</label>
              <input type="url" id="youtubeVideoUrl" [(ngModel)]="newCourse.youtube_vd_url" name="youtube_vd_url"
                     placeholder="https://www.youtube.com/watch?v=...">
              <small>Optionnel : URL directe de la vid√©o YouTube</small>
            </div>
            
            <!-- Form Actions moved to left column -->
            <div class="form-actions">
              <button type="submit" class="btn-submit" [disabled]="isSubmitting || loading">
                @if (loading || isSubmitting) {
                  <span class="loading-spinner"></span>
                  @if (mode === 'create') {
                    Cr√©ation du cours...
                  } @else {
                    Mise √† jour du cours...
                  }
                } @else {
                  @if (mode === 'create') {
                    <i class="icon-rocket"></i> Cr√©er le cours
                  } @else {
                    <i class="icon-check"></i> Mettre √† jour le cours
                  }
                }
              </button>
              @if (mode === 'edit') {
                <button type="button" class="btn-secondary" (click)="resetForm()"
                        [disabled]="isSubmitting || loading">
                  <i class="icon-cancel"></i> Annuler
                </button>
              }
            </div>
          </div>

          <!-- Right Column: Test Interface -->
          <div class="right-column">
            <div class="test-section">
              <div class="test-header">
                <h3>Ajouter un test pour votre cours</h3>
              </div>

              <!-- Small Test Name Form -->
              <div class="test-form test-name-form">
                <div class="form-group">
                  <label>Nom du test *</label>
                  <input type="text" [(ngModel)]="testName" name="testName"
                         placeholder="Entrez le nom du test" required>
                </div>
                <div class="test-form-actions">
                  <button type="button" class="btn-primary" (click)="saveTestName()" [disabled]="!testName || !testName.trim()">
                    Ajouter une question
                  </button>
                </div>
              </div>

              <!-- Question Form (appears when Add Question button is clicked) -->
              @if (showTestForm) {
                <div class="test-form">
                  <h4>Cr√©er une question pour votre test</h4>
                  <div class="form-group">
                    <label>Question *</label>
                    <input type="text" [(ngModel)]="currentQuiz.question" name="testQuestion"
                           placeholder="Entrez votre question de test" required>
                  </div>

                  <div class="options-section">
                    <label>Options</label>
                    <div class="options-list">
                      <div class="option-input">
                        <input type="text" [(ngModel)]="currentQuiz.options[0]" name="option_0"
                               placeholder="Option 1" required>
                      </div>
                      <div class="option-input">
                        <input type="text" [(ngModel)]="currentQuiz.options[1]" name="option_1"
                               placeholder="Option 2" required>
                      </div>
                      <div class="option-input">
                        <input type="text" [(ngModel)]="currentQuiz.options[2]" name="option_2"
                               placeholder="Option 3" required>
                      </div>
                      <div class="option-input">
                        <input type="text" [(ngModel)]="currentQuiz.options[3]" name="option_3"
                               placeholder="Option 4" required>
                      </div>
                    </div>
                  </div>

                  <div class="form-group">
                    <label>Bonne r√©ponse *</label>
                    <select [(ngModel)]="currentQuiz.correctAnswer" name="correctAnswer" required>
                      <option [value]="null" disabled selected>Select correct option</option>
                      <option [value]="0" [disabled]="!currentQuiz.options[0]?.trim()">Option 1 : {{ currentQuiz.options[0] || 'Option 1' }}</option>
                      <option [value]="1" [disabled]="!currentQuiz.options[1]?.trim()">Option 2 : {{ currentQuiz.options[1] || 'Option 2' }}</option>
                      <option [value]="2" [disabled]="!currentQuiz.options[2]?.trim()">Option 3 : {{ currentQuiz.options[2] || 'Option 3' }}</option>
                      <option [value]="3" [disabled]="!currentQuiz.options[3]?.trim()">Option 4 : {{ currentQuiz.options[3] || 'Option 4' }}</option>
                    </select>
                  </div>

                  <div class="test-form-actions">
                    <button type="button" class="btn-secondary" (click)="cancelTestForm()">Annuler</button>
                    <button type="button" class="btn-primary" (click)="saveTestQuestion()" [disabled]="!isQuizValid()">
                      Enregistrer la question
                    </button>
                </div>
              </div>
              }

              <!-- Existing Tests -->
              @if (oldCourse.quizzes.length > 0) {
                <div class="tests-list">
                  <h4>Questions existantes</h4>
                  <div class="test-item" *ngFor="let test of oldCourse.quizzes; let i = index">
                    <div class="test-item-header">
                      <h5>Question {{ i + 1 }}</h5>
                      <button type="button" class="btn-remove-test" (click)="removeQuiz(i)" title="Supprimer le test">
                        <i class="icon-trash"></i>
                      </button>
                    </div>
                    <div class="test-question">{{ test.question }}</div>
                    <div class="test-options">
                      <div class="test-option" *ngFor="let option of test.options; let j = index"
                           [class.correct]="j === test.correctAnswer">
                        <span class="option-letter">{{ getOptionLetter(j) }}.</span>
                        <span class="option-text">{{ option }}</span>
                        <span class="correct-badge" *ngIf="j === test.correctAnswer">Correct</span>
                      </div>
                    </div>
                  </div>
                </div>
              } @else if (!showTestForm && !currentQuiz.titre) {
                <div class="empty-tests">
                  <div class="empty-icon">üß†</div>
                  <p>Entrez un nom de test et cliquez sur ¬´ Ajouter une question ¬ª pour commencer !</p>
                </div>
              }
            </div>
          </div>
        </div>

      </form>
    </div>
  </section>

</div>

<app-footer></app-footer>
