<!-- üåê Navbar -->
<app-navbar></app-navbar>

<!-- üìö Contenu principal -->
<div class="manage-courses-page">
  <!-- Snackbar Notification -->
  @if (showSnackbar) {
    <div class="snackbar" [class.snackbar-success]="snackbarType === 'success'" [class.snackbar-error]="snackbarType === 'error'">
      <div class="snackbar-content">
        <span class="snackbar-icon" [class.icon-check]="snackbarType === 'success'" [class.icon-error]="snackbarType === 'error'"></span>
        {{ snackbarMessage }}
      </div>
    </div>
  }

  <!-- Page Header -->
  <header class="page-header">
    <div class="header-content">
      <h1>üìö Manage My Courses</h1>
      <p>Create, edit and organize your educational content</p>
    </div>
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-number">{{ courses.length }}</span>
        <span class="stat-label">Courses</span>
      </div>
    </div>
  </header>

  <!-- Messages -->
  @if (successMessage) {
    <div class="alert alert-success">
      <div class="alert-icon">‚úÖ</div>
      <div class="alert-content">
        <strong>Success!</strong> {{ successMessage }}
      </div>
      <button class="alert-close" (click)="successMessage = ''">&times;</button>
    </div>
  }

  @if (errorMessage) {
    <div class="alert alert-error">
      <div class="alert-icon">‚ùå</div>
      <div class="alert-content">
        <strong>Error:</strong> {{ errorMessage }}
      </div>
      <button class="alert-close" (click)="errorMessage = ''">&times;</button>
    </div>
  }

  <!-- Formulaire -->
  <section class="create-course-form">
    <div class="form-card">
      <div class="form-header">
        <h2>
          @if (mode === 'create') {
            <i class="icon-add"></i> Create New Course
          } @else {
            <i class="icon-edit"></i> Edit Course: {{ oldCourse.title }}
          }
        </h2>
        <div class="form-mode-indicator" [class.mode-create]="mode === 'create'" [class.mode-edit]="mode === 'edit'">
          {{ mode === 'create' ? 'Creating' : 'Editing' }}
        </div>
      </div>

      <form (ngSubmit)="onCreateCourse()" novalidate>
        <div class="two-column-layout">
          <!-- Left Column: Course Details -->
          <div class="left-column">
            <!-- Titre -->
            <div class="form-group" [class.error]="formErrors['title']">
              <label for="courseTitle">Course Title *</label>
              <input type="text" id="courseTitle" [(ngModel)]="oldCourse.title" name="title"
                     placeholder="Enter course title" [class.error]="formErrors['title']" required>
              @if (formErrors['title']) {
                <div class="error-message">{{ formErrors['title'] }}</div>
              }
            </div>

            <div class="form-group" [class.error]="formErrors['description']">
              <label for="courseDescription">Description *</label>
              <textarea id="courseDescription" [(ngModel)]="newCourse.description" name="description"
                        rows="4" placeholder="Describe what students will learn in this course"
                        [class.error]="formErrors['description']" required></textarea>
              @if (formErrors['description']) {
                <div class="error-message">{{ formErrors['description'] }}</div>
              }
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="courseCategory">Category</label>
                <select id="courseCategory" [(ngModel)]="oldCourse.category" name="category">
                  <option value="">Select category...</option>
                  <option value="programming">üíª Programming</option>
                  <option value="math">üìê Mathematics</option>
                  <option value="design">üé® Design & UX/UI</option>
                  <option value="science">üî¨ Sciences</option>
                  <option value="business">üíº Business</option>
                  <option value="language">üåê Languages</option>
                  <option value="other">üìö Other</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="courseImage">Cover Image URL</label>
              <input type="url" id="courseImage" [(ngModel)]="oldCourse.imageUrl" name="imageUrl"
                     placeholder="https://example.com/image.jpg">
              <small>Optional: URL to course thumbnail image</small>
            </div>

            <div class="form-group">
              <label for="youtubeVideoUrl">YouTube Video URL</label>
              <input type="url" id="youtubeVideoUrl" [(ngModel)]="newCourse.youtube_vd_url" name="youtube_vd_url"
                     placeholder="https://www.youtube.com/watch?v=...">
              <small>Optional: Direct YouTube video URL</small>
            </div>
            
            <!-- Form Actions moved to left column -->
            <div class="form-actions">
              <button type="submit" class="btn-submit" [disabled]="isSubmitting || loading">
                @if (loading || isSubmitting) {
                  <span class="loading-spinner"></span>
                  @if (mode === 'create') {
                    Creating Course...
                  } @else {
                    Updating Course...
                  }
                } @else {
                  @if (mode === 'create') {
                    <i class="icon-rocket"></i> Create Course
                  } @else {
                    <i class="icon-check"></i> Update Course
                  }
                }
              </button>
              @if (mode === 'edit') {
                <button type="button" class="btn-secondary" (click)="resetForm()"
                        [disabled]="isSubmitting || loading">
                  <i class="icon-cancel"></i> Cancel
                </button>
              }
            </div>
          </div>

          <!-- Right Column: Test Interface -->
          <div class="right-column">
            <div class="test-section">
              <div class="test-header">
                <h3>Add a test for your course</h3>
              </div>

              <!-- Small Test Name Form -->
              <div class="test-form test-name-form">
                <div class="form-group">
                  <label>Test Name *</label>
                  <input type="text" [(ngModel)]="testName" name="testName"
                         placeholder="Enter test name" required>
                </div>
                <div class="test-form-actions">
                  <button type="button" class="btn-primary" (click)="saveTestName()" [disabled]="!testName || !testName.trim()">
                    Add Question
                  </button>
                </div>
              </div>

              <!-- Question Form (appears when Add Question button is clicked) -->
              @if (showTestForm) {
                <div class="test-form">
                  <h4>Create a question for your test</h4>
                  <div class="form-group">
                    <label>Question *</label>
                    <input type="text" [(ngModel)]="currentQuiz.question" name="testQuestion"
                           placeholder="Enter your test question" required>
                  </div>

                  <div class="options-section">
                    <label>Options</label>
                    <div class="options-list">
                      <div class="option-input">
                        <input type="text" [(ngModel)]="currentQuiz.options[0]" name="option_0"
                               placeholder="Option 1" required>
                      </div>
                      <div class="option-input">
                        <input type="text" [(ngModel)]="currentQuiz.options[1]" name="option_1"
                               placeholder="Option 2" required>
                      </div>
                      <div class="option-input">
                        <input type="text" [(ngModel)]="currentQuiz.options[2]" name="option_2"
                               placeholder="Option 3" required>
                      </div>
                      <div class="option-input">
                        <input type="text" [(ngModel)]="currentQuiz.options[3]" name="option_3"
                               placeholder="Option 4" required>
                      </div>
                    </div>
                  </div>

                  <div class="form-group">
                    <label>Correct Answer *</label>
                    <select [(ngModel)]="currentQuiz.correctAnswer" name="correctAnswer" required>
                      <option [value]="null" disabled selected>Select correct option</option>
                      <option [value]="0" [disabled]="!currentQuiz.options[0]?.trim()">Option 1: {{ currentQuiz.options[0] || 'Option 1' }}</option>
                      <option [value]="1" [disabled]="!currentQuiz.options[1]?.trim()">Option 2: {{ currentQuiz.options[1] || 'Option 2' }}</option>
                      <option [value]="2" [disabled]="!currentQuiz.options[2]?.trim()">Option 3: {{ currentQuiz.options[2] || 'Option 3' }}</option>
                      <option [value]="3" [disabled]="!currentQuiz.options[3]?.trim()">Option 4: {{ currentQuiz.options[3] || 'Option 4' }}</option>
                    </select>
                  </div>

                  <div class="test-form-actions">
                    <button type="button" class="btn-secondary" (click)="cancelTestForm()">Cancel</button>
                    <button type="button" class="btn-primary" (click)="saveTestQuestion()" [disabled]="!isQuizValid()">
                      Save Question
                    </button>
                  </div>
                </div>
              }

              <!-- Existing Tests -->
              @if (oldCourse.quizzes.length > 0) {
                <div class="tests-list">
                  <h4>Existing Questions</h4>
                  <div class="test-item" *ngFor="let test of oldCourse.quizzes; let i = index">
                    <div class="test-item-header">
                      <h5>Question {{ i + 1 }}</h5>
                      <button type="button" class="btn-remove-test" (click)="removeQuiz(i)" title="Remove test">
                        <i class="icon-trash"></i>
                      </button>
                    </div>
                    <div class="test-question">{{ test.question }}</div>
                    <div class="test-options">
                      <div class="test-option" *ngFor="let option of test.options; let j = index"
                           [class.correct]="j === test.correctAnswer">
                        <span class="option-letter">{{ getOptionLetter(j) }}.</span>
                        <span class="option-text">{{ option }}</span>
                        <span class="correct-badge" *ngIf="j === test.correctAnswer">Correct</span>
                      </div>
                    </div>
                  </div>
                </div>
              } @else if (!showTestForm && !currentQuiz.titre) {
                <div class="empty-tests">
                  <div class="empty-icon">üß†</div>
                  <p>Enter a test name and click "Add Question" to get started!</p>
                </div>
              }
            </div>
          </div>
        </div>

      </form>
    </div>
  </section>

</div>

<app-footer></app-footer>