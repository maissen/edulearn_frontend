<!-- üåê Navbar -->
<app-navbar></app-navbar>

<!-- Contenu principal -->
<div class="course-detail-page">

  <!-- En-t√™te vid√©o -->
  <header class="course-header">
    <h1>{{ course?.title }}</h1>
    <p class="course-subtitle">{{ course?.subtitle }}</p>
    <div class="course-meta">
      <span>‚è±Ô∏è {{ course?.duration }}</span>
      <span>‚≠ê {{ instructor.rating }}/5</span>
    </div>
  </header>

  <!-- Player vid√©o -->
  <div class="video-player">
    <iframe 
  [src]="safeVideoUrl"
  frameborder="0" 
  allowfullscreen
  width="100%" 
  height="400px">
</iframe>
  </div>

  <!-- Description & sections -->
  <div class="course-content">

  <!-- Course Description -->
  <section class="course-description-section">
    <h2>üìñ Course Description</h2>
    <p>{{ course?.description }}</p>
  </section>

  <!-- Quiz Section -->
  <section class="quiz-section">
    <div class="quiz-header">
      <h2>üß† Practice Quizzes</h2>
      @if (isTeacher) {
        <button type="button" class="btn-add-quiz" (click)="openAddQuizModal()">
          <i class="icon-plus"></i> Add Quiz
        </button>
      }
    </div>

    @if (quizzes.length === 0) {
      <div class="empty-quiz">
        <div class="empty-icon">üß†</div>
        <h3>No quizzes yet</h3>
        <p>Quizzes will help students test their knowledge and understanding.</p>
        @if (isTeacher) {
          <button type="button" class="btn-add-first-quiz" (click)="openAddQuizModal()">
            Create First Quiz
          </button>
        }
      </div>
    } @else {
      <div class="quiz-gallery">
        <div class="quiz-card" *ngFor="let quiz of quizzes; let i = index">
          <div class="quiz-card-header">
            <div class="quiz-number">Quiz {{ i + 1 }}</div>
            @if (isTeacher) {
              <div class="quiz-actions">
                <button class="btn-edit-quiz" (click)="editQuiz(i)" title="Edit quiz">
                  <i class="icon-edit"></i>
                </button>
                <button class="btn-delete-quiz" (click)="deleteQuiz(i)" title="Delete quiz">
                  <i class="icon-trash"></i>
                </button>
              </div>
            }
          </div>
          <div class="quiz-card-content">
            <h3 class="quiz-question">{{ quiz.question }}</h3>
            <div class="quiz-options">
              <div class="option" *ngFor="let option of quiz.options; let j = index"
                   [class.correct]="j === quiz.correctAnswer">
                <span class="option-label">{{ j + 1 }}.</span>
                <span class="option-text">{{ option }}</span>
                @if (j === quiz.correctAnswer) {
                  <span class="correct-badge">‚úì Correct</span>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </section>
  </div>

  <!-- Recommandations -->
  <section class="related-section" *ngIf="!isTeacher">
    <h2>üéì Student also bought</h2>
    <div class="related-grid">
      <div class="related-card" *ngFor="let c of relatedCourses">
        <img [src]="c.imageUrl" [alt]="c.titre" class="related-image">
        <div class="related-info">
          <h3>{{ c.titre }}</h3>
          <div class="related-meta">
            <span>‚≠ê {{ c.rating }}/5</span>
            <span>${{ c.price }}</span>
          </div>
          <button class="btn-enroll">Enroll Now</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Quiz Modal -->
  @if (showQuizModal) {
    <div class="modal-overlay" (click)="closeQuizModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ editingQuizIndex !== null ? 'Edit Quiz' : 'Add New Quiz' }}</h3>
          <button type="button" class="modal-close" (click)="closeQuizModal()">
            <i class="icon-close"></i>
          </button>
        </div>

        <form (ngSubmit)="saveQuiz()" class="quiz-form">
          <div class="form-group">
            <label for="quizQuestion">Question *</label>
            <input type="text" id="quizQuestion" [(ngModel)]="currentQuiz.question"
                   name="question" placeholder="Enter your quiz question" required>
          </div>

          <div class="options-section">
            <label>Options</label>
            <div class="options-list">
              <div class="option-input" *ngFor="let option of currentQuiz.options; let j = index">
                <input type="text" [(ngModel)]="currentQuiz.options[j]"
                       [name]="'option_' + j"
                       [placeholder]="'Option ' + (j + 1)"
                       required>
                <button type="button" class="btn-remove-option"
                        (click)="removeOption(j)"
                        [disabled]="currentQuiz.options.length <= 2">
                  <i class="icon-minus"></i>
                </button>
              </div>
            </div>
            <button type="button" class="btn-add-option" (click)="addOption()">
              <i class="icon-plus"></i> Add Option
            </button>
          </div>

          <div class="form-group">
            <label for="correctAnswer">Correct Answer *</label>
            <select id="correctAnswer" [(ngModel)]="currentQuiz.correctAnswer" name="correctAnswer" required>
              <option [value]="j" *ngFor="let option of currentQuiz.options; let j = index">
                Option {{ j + 1 }}: {{ option || 'Option ' + (j + 1) }}
              </option>
            </select>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeQuizModal()">Cancel</button>
            <button type="submit" class="btn-primary" [disabled]="!isQuizFormValid()">
              {{ editingQuizIndex !== null ? 'Update Quiz' : 'Create Quiz' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }

</div>

<!-- üèÅ Footer (identique au template) -->
<footer class="footer">
  <div class="footer-logo">
    <app-logo></app-logo>
    <span>EduLearn</span>
  </div>
  <p class="footer-subtitle">Virtual Class for Zoom</p>
  <p>Subscribe to get our Newsletter</p>
  <form class="newsletter-form">
    <input type="email" placeholder="Your Email" class="newsletter-input">
    <button type="submit" class="newsletter-btn">Subscribe</button>
  </form>
  <div class="footer-links">
    <a href="#">Careers</a>
    <a href="#">Privacy Policy</a>
    <a href="#">Terms & Conditions</a>
  </div>
  <p class="footer-copyright">¬© 2025 Class Technologies Inc.</p>
</footer>