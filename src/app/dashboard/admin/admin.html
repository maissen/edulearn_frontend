<div class="admin-dashboard">
  <!-- Top Navigation with Logout Button -->
  <div class="top-nav">
    <div class="nav-logo">EduLearn Admin</div>
    <div class="nav-actions">
      <span class="user-name">Welcome, {{ userName }}</span>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="hero-banner">
    <div class="hero-content">
      <h1>Admin Dashboard</h1>
      <p>Manage your school platform from here.</p>
    </div>
  </section>

  <!-- Success and Error Messages -->
  <div *ngIf="successMessage" class="success-message">
    <p>{{ successMessage }}</p>
  </div>
  
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="loading" class="loading">
    <p>Loading users...</p>
  </div>

  <!-- Action loading indicator -->
  <div *ngIf="actionLoading" class="action-loading">
    <p>Processing request...</p>
  </div>

  <!-- Users Section -->
  <section class="users-section" *ngIf="!loading && !error">
    <!-- Teachers Table -->
    <div class="table-container">
      <div class="table-header">
        <h2>Teachers</h2>
        <button class="create-btn" (click)="openCreateTeacherForm()">Create New Teacher</button>
      </div>
      
      <!-- Teacher Filter -->
      <div class="filter-section">
        <div class="filter-group">
          <button 
            class="filter-btn" 
            [class.active]="teacherFilter === 'all'"
            (click)="updateTeacherFilter('all')">
            All Teachers
          </button>
          <button 
            class="filter-btn" 
            [class.active]="teacherFilter === 'active'"
            (click)="updateTeacherFilter('active')">
            Active Only
          </button>
          <button 
            class="filter-btn" 
            [class.active]="teacherFilter === 'inactive'"
            (click)="updateTeacherFilter('inactive')">
            Inactive Only
          </button>
          <button 
            class="filter-btn" 
            [class.active]="teacherFilter === 'newest'"
            (click)="updateTeacherFilter('newest')">
            Newest First
          </button>
          <button 
            class="filter-btn" 
            [class.active]="teacherFilter === 'oldest'"
            (click)="updateTeacherFilter('oldest')">
            Oldest First
          </button>
        </div>
      </div>
      
      <table class="users-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Module</th>
            <th>Status</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let teacher of paginatedTeachers">
            <td>{{ teacher.id }}</td>
            <td>{{ teacher.username }}</td>
            <td>{{ teacher.email }}</td>
            <td>{{ teacher.module }}</td>
            <td>
              <span class="status-badge" [ngClass]="{'active': teacher.isActivated, 'inactive': !teacher.isActivated}">
                {{ teacher.isActivated ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>{{ teacher.created_at | date:'short' }}</td>
            <td class="action-buttons">
              <button 
                class="toggle-btn" 
                [ngClass]="{'disable-btn': teacher.isActivated, 'enable-btn': !teacher.isActivated}"
                (click)="toggleTeacherActivation(teacher)"
                [disabled]="actionLoading">
                {{ teacher.isActivated ? 'Disable' : 'Enable' }}
              </button>
              <button 
                class="delete-btn"
                (click)="openDeleteConfirm('teacher', teacher.id, teacher.username)"
                [disabled]="actionLoading">
                Delete
              </button>
            </td>
          </tr>
          <tr *ngIf="paginatedTeachers.length === 0">
            <td colspan="7" class="no-data">No teachers found</td>
          </tr>
        </tbody>
      </table>
      
      <!-- Teachers Pagination -->
      <div class="pagination-controls" *ngIf="getTeacherFilteredCount() > itemsPerPage">
        <button 
          (click)="prevPageTeachers()" 
          [disabled]="currentPageTeachers === 1"
          class="pagination-btn">
          Previous
        </button>
        <span class="pagination-info">
          Page {{ currentPageTeachers }} of {{ getTotalPagesTeachers() }}
        </span>
        <button 
          (click)="nextPageTeachers()" 
          [disabled]="currentPageTeachers === getTotalPagesTeachers()"
          class="pagination-btn">
          Next
        </button>
      </div>
    </div>

    <!-- Students Table -->
    <div class="table-container">
      <div class="table-header">
        <h2>Students</h2>
        <button class="create-btn" (click)="openCreateStudentForm()">Create New Student</button>
      </div>
      
      <!-- Student Filter -->
      <div class="filter-section">
        <div class="filter-group">
          <button 
            class="filter-btn" 
            [class.active]="studentFilter === 'all'"
            (click)="updateStudentFilter('all')">
            All Students
          </button>
          <button 
            class="filter-btn" 
            [class.active]="studentFilter === 'active'"
            (click)="updateStudentFilter('active')">
            Active Only
          </button>
          <button 
            class="filter-btn" 
            [class.active]="studentFilter === 'inactive'"
            (click)="updateStudentFilter('inactive')">
            Inactive Only
          </button>
          <button 
            class="filter-btn" 
            [class.active]="studentFilter === 'newest'"
            (click)="updateStudentFilter('newest')">
            Newest First
          </button>
          <button 
            class="filter-btn" 
            [class.active]="studentFilter === 'oldest'"
            (click)="updateStudentFilter('oldest')">
            Oldest First
          </button>
        </div>
      </div>
      
      <table class="users-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Status</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of paginatedStudents">
            <td>{{ student.id }}</td>
            <td>{{ student.username }}</td>
            <td>{{ student.email }}</td>
            <td>
              <span class="status-badge" [ngClass]="{'active': student.isActivated, 'inactive': !student.isActivated}">
                {{ student.isActivated ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>{{ student.created_at | date:'short' }}</td>
            <td class="action-buttons">
              <button 
                class="toggle-btn" 
                [ngClass]="{'disable-btn': student.isActivated, 'enable-btn': !student.isActivated}"
                (click)="toggleStudentActivation(student)"
                [disabled]="actionLoading">
                {{ student.isActivated ? 'Disable' : 'Enable' }}
              </button>
              <button 
                class="delete-btn"
                (click)="openDeleteConfirm('student', student.id, student.username)"
                [disabled]="actionLoading">
                Delete
              </button>
            </td>
          </tr>
          <tr *ngIf="paginatedStudents.length === 0">
            <td colspan="6" class="no-data">No students found</td>
          </tr>
        </tbody>
      </table>
      
      <!-- Students Pagination -->
      <div class="pagination-controls" *ngIf="getStudentFilteredCount() > itemsPerPage">
        <button 
          (click)="prevPageStudents()" 
          [disabled]="currentPageStudents === 1"
          class="pagination-btn">
          Previous
        </button>
        <span class="pagination-info">
          Page {{ currentPageStudents }} of {{ getTotalPagesStudents() }}
        </span>
        <button 
          (click)="nextPageStudents()" 
          [disabled]="currentPageStudents === getTotalPagesStudents()"
          class="pagination-btn">
          Next
        </button>
      </div>
    </div>

    <!-- Courses Table -->
    <div class="table-container">
      <div class="table-header">
        <h2>Courses</h2>
      </div>
      
      <!-- Course Filter -->
      <div class="filter-section">
        <div class="filter-group">
          <select [(ngModel)]="courseFilterType" class="filter-select" (change)="updateCourseFilter()">
            <option value="teacher">Filter by Teacher</option>
            <option value="category">Filter by Category</option>
          </select>
          <input 
            type="text" 
            [(ngModel)]="courseFilter" 
            (input)="updateCourseFilter()"
            placeholder="Enter filter text..." 
            class="filter-input">
          <button 
            *ngIf="courseFilter" 
            (click)="clearCourseFilter()" 
            class="clear-filter-btn">
            Clear
          </button>
        </div>
      </div>
      
      <!-- Course Loading indicator -->
      <div *ngIf="courseLoading" class="loading">
        <p>Loading courses...</p>
      </div>
      
      <table class="users-table" *ngIf="!courseLoading">
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Description</th>
            <th>Category</th>
            <th>Teacher</th>
            <th>Test Questions</th>
            <th>Enrolled Students</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let course of paginatedCourses">
            <td>{{ course.id }}</td>
            <td>{{ course.title }}</td>
            <td>{{ course.description }}</td>
            <td>{{ course.category }}</td>
            <td>{{ course.teacherName }}</td>
            <td>{{ course.test.question_count || 0 }}</td>
            <td>{{ course.enrolled_student_count }}</td>
            <td class="action-buttons">
              <button 
                class="delete-btn"
                (click)="openCourseDeleteConfirm(course.id, course.title)"
                [disabled]="actionLoading">
                Delete
              </button>
            </td>
          </tr>
          <tr *ngIf="paginatedCourses.length === 0">
            <td colspan="8" class="no-data">No courses found</td>
          </tr>
        </tbody>
      </table>
      
      <!-- Courses Pagination -->
      <div class="pagination-controls" *ngIf="getCourseFilteredCount() > itemsPerPage && !courseLoading">
        <button 
          (click)="prevPageCourses()" 
          [disabled]="currentPageCourses === 1"
          class="pagination-btn">
          Previous
        </button>
        <span class="pagination-info">
          Page {{ currentPageCourses }} of {{ getTotalPagesCourses() }}
        </span>
        <button 
          (click)="nextPageCourses()" 
          [disabled]="currentPageCourses === getTotalPagesCourses()"
          class="pagination-btn">
          Next
        </button>
      </div>
    </div>
  </section>

  <!-- Create Teacher Modal -->
  <div class="modal" *ngIf="showCreateTeacherForm">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create New Teacher</h3>
        <span class="close" (click)="closeCreateTeacherForm()">&times;</span>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="createTeacher()" #teacherForm="ngForm">
          <div class="form-group">
            <label for="teacherUsername">Username *</label>
            <input 
              type="text" 
              id="teacherUsername" 
              [(ngModel)]="newTeacher.username" 
              name="teacherUsername" 
              class="form-control" 
              required
              placeholder="Enter teacher's username">
          </div>
          
          <div class="form-group">
            <label for="teacherEmail">Email *</label>
            <input 
              type="email" 
              id="teacherEmail" 
              [(ngModel)]="newTeacher.email" 
              name="teacherEmail" 
              class="form-control" 
              required
              placeholder="Enter teacher's email">
          </div>
          
          <div class="form-group">
            <label for="teacherPassword">Password *</label>
            <input 
              type="password" 
              id="teacherPassword" 
              [(ngModel)]="newTeacher.password" 
              name="teacherPassword" 
              class="form-control" 
              required
              placeholder="Enter teacher's password">
          </div>
          
          <div class="form-group">
            <label for="teacherModule">Module</label>
            <input 
              type="text" 
              id="teacherModule" 
              [(ngModel)]="newTeacher.module" 
              name="teacherModule" 
              class="form-control"
              placeholder="Enter teacher's module (optional)">
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeCreateTeacherForm()" [disabled]="actionLoading">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="actionLoading">
              {{ actionLoading ? 'Creating...' : 'Create Teacher' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Create Student Modal -->
  <div class="modal" *ngIf="showCreateStudentForm">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create New Student</h3>
        <span class="close" (click)="closeCreateStudentForm()">&times;</span>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="createStudent()" #studentForm="ngForm">
          <div class="form-group">
            <label for="studentUsername">Username *</label>
            <input 
              type="text" 
              id="studentUsername" 
              [(ngModel)]="newStudent.username" 
              name="studentUsername" 
              class="form-control" 
              required
              placeholder="Enter student's username">
          </div>
          
          <div class="form-group">
            <label for="studentEmail">Email *</label>
            <input 
              type="email" 
              id="studentEmail" 
              [(ngModel)]="newStudent.email" 
              name="studentEmail" 
              class="form-control" 
              required
              placeholder="Enter student's email">
          </div>
          
          <div class="form-group">
            <label for="studentPassword">Password *</label>
            <input 
              type="password" 
              id="studentPassword" 
              [(ngModel)]="newStudent.password" 
              name="studentPassword" 
              class="form-control" 
              required
              placeholder="Enter student's password">
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeCreateStudentForm()" [disabled]="actionLoading">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="actionLoading">
              {{ actionLoading ? 'Creating...' : 'Create Student' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal" *ngIf="showDeleteConfirm">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirm Deletion</h3>
        <span class="close" (click)="closeDeleteConfirm()">&times;</span>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete <strong>{{ deleteItemName }}</strong>? This action cannot be undone and will permanently remove all associated data.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteConfirm()" [disabled]="actionLoading">
          Cancel
        </button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="actionLoading">
          {{ actionLoading ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Course Delete Confirmation Modal -->
  <div class="modal" *ngIf="showCourseDeleteConfirm">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirm Course Deletion</h3>
        <span class="close" (click)="closeCourseDeleteConfirm()">&times;</span>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the course <strong>{{ deleteCourseTitle }}</strong>? This action cannot be undone and will permanently remove all associated data including tests, questions, enrollments, and test results.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeCourseDeleteConfirm()" [disabled]="actionLoading">
          Cancel
        </button>
        <button type="button" class="btn btn-danger" (click)="confirmCourseDelete()" [disabled]="actionLoading">
          {{ actionLoading ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Background Overlay -->
  <div class="modal-overlay" *ngIf="showCreateTeacherForm || showCreateStudentForm || showDeleteConfirm || showCourseDeleteConfirm"></div>
</div>