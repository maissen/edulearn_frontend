<!-- Barre de navigation -->
<app-navbar></app-navbar>

<!-- Hero Section -->
<div class="hero-section" *ngIf="!loading && !errorMessage">
  <div class="hero-content">
    <h1>Discover Amazing Courses</h1>
    <p>Explore our wide range of courses organized by category</p>
    <div class="category-filter">
      <select [(ngModel)]="selectedCategory" (change)="onCategoryChange()" class="category-select">
        <option *ngFor="let category of categories" [value]="category">
          {{ category === 'All' ? 'All Categories' : category }}
        </option>
      </select>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p>Loading courses...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="errorMessage && !loading">
  <div class="error-message">
    <h3>Oops! Something went wrong</h3>
    <p>{{ errorMessage }}</p>
    <button (click)="loadCourses()" class="retry-btn">Try Again</button>
  </div>
</div>

<!-- Courses Content -->
<div class="courses-container" *ngIf="!loading && !errorMessage">

  <!-- Display filtered courses when a specific category is selected -->
  <section class="filtered-courses" *ngIf="selectedCategory !== 'All'">
    <div class="section-header">
      <h2 class="section-title">{{ selectedCategory }} Courses</h2>
      <p class="section-subtitle">Discover all courses in {{ selectedCategory }}</p>
    </div>
    <div class="course-grid">
      <div class="course-card" *ngFor="let course of filteredCourses" (click)="openCourse(course.id)">
        <div class="course-image-container">
          <img [src]="course.image" [alt]="course.title" class="course-image" (error)="onImageError($event)">
        </div>
        <div class="course-content">
          <h3 class="course-title">{{ course.title }}</h3>
          <p class="course-description">{{ course.title }} - Learn the fundamentals and advanced concepts</p>
          <div class="course-meta">
            <span class="lesson-info">Lesson {{ course.currentLesson }} of {{ course.totalLessons }}</span>
            <!-- Removed rating stars -->
          </div>
          <div class="enrollment-status" *ngIf="getEnrollmentStatus(course.id)">
            <span class="status-badge" [ngClass]="{
              'not-enrolled': !getEnrollmentStatus(course.id)?.isEnrolled,
              'in-progress': getEnrollmentStatus(course.id)?.status === 'in_progress',
              'completed': getEnrollmentStatus(course.id)?.status === 'completed'
            }">
              <span class="status-icon">
                <ng-container [ngSwitch]="getEnrollmentStatus(course.id)?.status">
                  <span *ngSwitchCase="'in_progress'">‚è≥</span>
                  <span *ngSwitchCase="'completed'">‚úÖ</span>
                  <span *ngSwitchDefault>üìö</span>
                </ng-container>
              </span>
              <span class="status-text">
                <ng-container [ngSwitch]="getEnrollmentStatus(course.id)?.status">
                  <span *ngSwitchCase="'in_progress'">In Progress ({{ getEnrollmentStatus(course.id)?.progressPercentage }}%)</span>
                  <span *ngSwitchCase="'completed'">Completed</span>
                  <span *ngSwitchDefault>Not Enrolled</span>
                </ng-container>
              </span>
            </span>
          </div>
          <div class="course-footer">
            <span class="progress-text" *ngIf="getEnrollmentStatus(course.id)?.isEnrolled && getEnrollmentStatus(course.id)?.status === 'in_progress'">
              {{ getEnrollmentStatus(course.id)?.progressPercentage }}% Complete
            </span>
            <span class="enrollment-count" *ngIf="!getEnrollmentStatus(course.id)?.isEnrolled || getEnrollmentStatus(course.id)?.status !== 'in_progress'">
              {{ Math.floor(Math.random() * 500) + 50 }} students enrolled
            </span>
          </div>
          <!-- Moved category to bottom -->
          <div class="course-category-bottom">{{ course.category }}</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Display all categories when "All" is selected -->
  <div *ngIf="selectedCategory === 'All'">
    <section class="category-section" *ngFor="let category of Object.keys(groupedCourses)">
      <div class="section-header">
        <h2 class="section-title">{{ category }}</h2>
        <p class="section-subtitle">Explore {{ groupedCourses[category].courses.length }} course{{ groupedCourses[category].courses.length !== 1 ? 's' : '' }} in {{ category }}</p>
      </div>
      <div class="course-grid">
        <div class="course-card" *ngFor="let course of groupedCourses[category].courses; let i = index" (click)="openCourse(course.id)">
          <div class="course-image-container">
            <img [src]="'https://picsum.photos/300/180?random=' + (i + 100)" [alt]="course.titre" class="course-image" (error)="onImageError($event)">
          </div>
        <div class="course-content">
          <h3 class="course-title">{{ course.titre }}</h3>
          <p class="course-description">{{ course.description || course.titre + ' - Learn the fundamentals and advanced concepts' }}</p>
          <div class="course-meta">
            <span class="teacher-info">By {{ course.teacher_username }}</span>
            <!-- Removed rating stars -->
          </div>
          <div class="enrollment-status" *ngIf="getEnrollmentStatus(course.id)">
            <span class="status-badge" [ngClass]="{
              'not-enrolled': !getEnrollmentStatus(course.id)?.isEnrolled,
              'in-progress': getEnrollmentStatus(course.id)?.status === 'in_progress',
              'completed': getEnrollmentStatus(course.id)?.status === 'completed'
            }">
              <span class="status-icon">
                <ng-container [ngSwitch]="getEnrollmentStatus(course.id)?.status">
                  <span *ngSwitchCase="'in_progress'">‚è≥</span>
                  <span *ngSwitchCase="'completed'">‚úÖ</span>
                  <span *ngSwitchDefault>üìö</span>
                </ng-container>
              </span>
              <span class="status-text">
                <ng-container [ngSwitch]="getEnrollmentStatus(course.id)?.status">
                  <span *ngSwitchCase="'in_progress'">In Progress ({{ getEnrollmentStatus(course.id)?.progressPercentage }}%)</span>
                  <span *ngSwitchCase="'completed'">Completed</span>
                  <span *ngSwitchDefault>Not Enrolled</span>
                </ng-container>
              </span>
            </span>
          </div>
          <div class="course-footer">
            <span class="enrollment-count">{{ groupedCourses[category].enrolledStudents }} students enrolled</span>
          </div>
          <!-- Moved category to bottom -->
          <div class="course-category-bottom">{{ category }}</div>
        </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="footer-logo">
    <img src="assets/images/logo-white.png" alt="EduLearn Logo">
    <span>EduLearn</span>
  </div>
  <p class="footer-subtitle">Virtual Class for Zoom</p>
  <p>Subscribe to get our Newsletter</p>
  <form class="newsletter-form">
    <input type="email" placeholder="Your Email" class="newsletter-input">
    <button type="submit" class="newsletter-btn">Subscribe</button>
  </form>
  <div class="footer-links">
    <a href="#">Careers</a>
    <a href="#">Privacy Policy</a>
    <a href="#">Terms & Conditions</a>
  </div>
  <p class="footer-copyright">¬© 2025 Class Technologies Inc.</p>
</footer>