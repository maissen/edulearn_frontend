<!-- Barre de navigation -->
<app-navbar></app-navbar>

<!-- Hero Section -->
<div class="hero-section" *ngIf="!loading && !errorMessage">
  <div class="hero-content">
    <h1>Découvrez des cours exceptionnels</h1>
    <p>Explorez notre vaste gamme de cours organisés par catégorie</p>
    <div class="search-container">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
        placeholder="Rechercher des cours par nom..." 
        class="search-input"
      >
    </div>
    <div class="category-filter">
      <select [(ngModel)]="selectedCategory" (change)="onCategoryChange()" class="category-select">
        <option *ngFor="let category of categories" [value]="category">
          {{ category === 'All' ? 'Toutes les catégories' : category }}
        </option>
      </select>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p>Chargement des cours...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="errorMessage && !loading">
  <div class="error-message">
    <h3>Oups ! Quelque chose s'est mal passé</h3>
    <p>{{ errorMessage }}</p>
    <button (click)="loadCourses()" class="retry-btn">Réessayer</button>
  </div>
</div>

<!-- Courses Content -->
<div class="courses-container" *ngIf="!loading && !errorMessage">

  <!-- Display filtered courses when a specific category is selected -->
  <section class="filtered-courses" *ngIf="selectedCategory !== 'All'">
    <div class="section-header">
      <h2 class="section-title">Cours de {{ selectedCategory }}</h2>
      <p class="section-subtitle">Découvrez tous les cours dans {{ selectedCategory }}</p>
    </div>
    <div class="course-grid">
      <div class="course-card" *ngFor="let course of filteredCourses" (click)="openCourse(course.id)">
        <div class="course-image-container">
          <img [src]="course.image || 'https://picsum.photos/300/180?random=999'" [alt]="course.title" class="course-image" (error)="onImageError($event)">
          <span class="course-category">{{ course.category }}</span>
        </div>
        <div class="course-content">
          <h3 class="course-title">{{ course.title }}</h3>
          <p class="course-description">{{ course.title }} - Découvrez les fondamentaux et les concepts avancés</p>
          <div class="course-meta">
            <span class="course-duration">⏱️ 2 heures</span>
            <span class="course-status" [ngClass]="getEnrollmentStatus(course.id)?.status || 'not-enrolled'">
              <ng-container [ngSwitch]="getEnrollmentStatus(course.id)?.status">
                <span *ngSwitchCase="'in_progress'">En cours</span>
                <span *ngSwitchCase="'completed'">Terminé</span>
                <span *ngSwitchDefault>Non inscrit</span>
              </ng-container>
            </span>
          </div>
          <div class="course-footer">
            <span class="progress-text" *ngIf="getEnrollmentStatus(course.id)?.isEnrolled && getEnrollmentStatus(course.id)?.status === 'in_progress'">
              {{ getEnrollmentStatus(course.id)?.progressPercentage }}% Terminé
            </span>
            <span class="enrollment-count" *ngIf="!getEnrollmentStatus(course.id)?.isEnrolled || getEnrollmentStatus(course.id)?.status !== 'in_progress'">
              {{ Math.floor(Math.random() * 500) + 50 }} étudiants inscrits
            </span>
          </div>
          <!-- Moved category to bottom -->
          <div class="course-category-bottom">{{ course.category }}</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Display filtered courses when "All" is selected -->
  <section class="filtered-courses" *ngIf="selectedCategory === 'All'">
    <div class="section-header">
      <h2 class="section-title">Tous les cours</h2>
      <p class="section-subtitle">Découvrez tous les cours dans toutes les catégories</p>
    </div>
    <div class="course-grid">
      <div class="course-card" *ngFor="let course of filteredCourses" (click)="openCourse(course.id)">
        <div class="course-image-container">
          <img [src]="course.image || 'https://picsum.photos/300/180?random=999'" [alt]="course.title" class="course-image" (error)="onImageError($event)">
          <span class="course-category">{{ course.category }}</span>
        </div>
        <div class="course-content">
          <h3 class="course-title">{{ course.title }}</h3>
          <p class="course-description">{{ course.title }}</p>
          <div class="course-meta">
            <span class="course-duration">⏱️ 2 heures</span>
            <span class="course-status" [ngClass]="getEnrollmentStatus(course.id)?.status || 'not-enrolled'">
              <ng-container [ngSwitch]="getEnrollmentStatus(course.id)?.status">
                <span *ngSwitchCase="'in_progress'">En cours</span>
                <span *ngSwitchCase="'completed'">Terminé</span>
                <span *ngSwitchDefault>Non inscrit</span>
              </ng-container>
            </span>
          </div>
          <div class="course-footer">
            <span class="progress-text" *ngIf="getEnrollmentStatus(course.id)?.isEnrolled && getEnrollmentStatus(course.id)?.status === 'in_progress'">
              {{ getEnrollmentStatus(course.id)?.progressPercentage }}% Terminé
            </span>
            <span class="enrollment-count" *ngIf="!getEnrollmentStatus(course.id)?.isEnrolled || getEnrollmentStatus(course.id)?.status !== 'in_progress'">
              {{ Math.floor(Math.random() * 500) + 50 }} étudiants inscrits
            </span>
          </div>
          <!-- Moved category to bottom -->
          <div class="course-category-bottom">{{ course.category }}</div>
        </div>
      </div>
    </div>
  </section>
</div>

<app-footer></app-footer>